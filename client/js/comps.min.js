Vue.component("character",{template:`\n    <div \n        class="character" \n        :class="cleanClassClasses(character.wow_class)"\n        @click.self="$emit('click', character.name)"\n    >\n        <div class="name"\n            @click.self="$emit('click', character.name)"\n        >\n            {{character.name}}\n        </div>\n        <aui-button \n            class="delete" \n            v-if="!read_only" \n            @click="$emit('remove')"\n        >\n            <i class="fas fa-times"></i>\n        </aui-button>\n    </div>`,props:{character:{type:Object,required:true},read_only:{type:Boolean,default:false}},methods:{cleanClassClasses(wow_class){return"background-"+wow_class.replace(" ","").toLowerCase()}}});Vue.component("picker",{template:`\n    <div class="picker">\n        <h1>{{role}}</h1>\n        <h2 class="count">{{characters_added.length}}</h2>\n        <div class="added">\n            <character \n                v-for="character in characters_added"\n                :character="character"\n                @click="emitReplace(character)"\n                @remove="emitRemove(character)"\n            ></character>\n        </div>\n        <div class="add" v-if="characters_unadded.length > 0">\n            <aui-button\n                @click="emitAdd()"\n                class="add-character"\n            >\n                <i class="fas fa-plus"></i>\n            </aui-button>\n        </div>\n    </div>`,props:{characters_added:{type:Array,required:true},characters_unadded:{type:Array,required:true},role:{type:String,required:true}},methods:{getCount(){return this.characters_added},emitReplace(character){this.$emit("replace",{character:character,role:this.role})},emitAdd(character){this.$emit("add",{role:this.role})},emitRemove(character){this.$emit("remove",{character:character})}},data(){return{count:null}},mounted(){}});Vue.component("add-modal",{template:`\n        <aui-modal\n            :title="title"\n            :show="show"\n            class="add-modal"\n            @close="$emit('close')"\n        >\n            <character\n                v-for="character in characters_unadded"\n                :character="character"\n                :read_only="true"\n                @click="emitRosterChange"\n            ></character>\n        </aui-modal>\n    `,props:{title:{type:String,required:true},show:{type:Boolean,required:true},characters_unadded:{type:Array,required:true}},methods:{emitRosterChange(character){this.$emit("roster-change",character)}}});Vue.component("raid-date-picker",{template:`\n    <div class="raid-date-picker">\n        <aui-input\n            v-model="value"\n            label="Raid Week"\n            @focus="focus()"\n        ></aui-input>\n        <aui-modal class="raid-weeks" title="Raid Weeks" :show="show_picker" :closeable="true" @close="show_picker = false">\n            <div class="date" v-for="date in dates" @click="chooseDate(date)">\n                <span>{{date.start}}</span>\n                <span>-</span>\n                <span>{{date.end}}</span>\n            </div>\n        </aui-modal>\n    </div>\n    `,data(){return{show_picker:false,dates:[],value:null}},methods:{focus(){this.show_picker=true;this.dates=this.generateMonthOfWeekRanges()},generateMonthOfWeekRanges(){let dates=[];for(let i=0;i<4;i++){let newRange={};let startDate=new Date;startDate.setDate(startDate.getDate()+7*i+(2+7-startDate.getDay())%7);newRange.start=`${startDate.getMonth()+1}/${startDate.getDate()}/${startDate.getFullYear()}`;let endDate=new Date;endDate.setDate(endDate.getDate()+7*i+(1+7-endDate.getDay())%7);newRange.end=`${endDate.getMonth()+1}/${endDate.getDate()}/${endDate.getFullYear()}`;dates.push(newRange)}return dates},chooseDate(date){this.$emit("date",date.start);this.value=date.start;this.show_picker=false}},mounted(){this.chooseDate(this.generateMonthOfWeekRanges()[0])}});let instance=new Vue({el:"#comp-builder",data:{characters:[],characters_added:[],replace:null,instance:null,instances:null,week:null,modal:{title:"Add Character",state:false,role:null},boss:{selected:null,options:[]}},methods:{replaceModal(payload){this.replace=payload.character;this.modal.title=`Replace ${payload.character.name}`;this.modal.role=payload.role;this.modal.state=true},addModal(payload){this.replace=null;this.modal.title="Add Character";this.modal.role=payload.role;this.modal.state=true},addedCharacters(role){return this.characters.filter(character=>{return Object.values(this.characters_added).some(el=>el.name===character.name)&&character.role===role})},unAddedCharacters(role){return this.characters.filter(character=>{if(this.characters_added.length){let added_to_list=true;Object.values(this.characters_added).forEach(added=>{if(character.name===added.name||character.role!==role){added_to_list=false}});return added_to_list}else{return character.role===role}})},getBossNameRelative(index){return this.boss.options[parseInt(this.boss.selected)+parseInt(index)]?this.boss.options[parseInt(this.boss.selected)+parseInt(index)]:false},selectBossAtRelativeIndex(index){this.boss.selected=parseInt(this.boss.selected)+parseInt(index)},dateChange(payload){this.week=payload;this.getRoster()},getInstances(){DynamicSuite.call("baddies-insight","instances:read",null,response=>{if(response.status==="OK"){this.instances=response.data;this.$nextTick(()=>{this.instance=Object.keys(response.data)[1];this.getBosses();this.getRoster()})}else{console.log(response)}})},getBosses(){let data={instance_id:this.instance};DynamicSuite.call("baddies-insight","bosses:read",data,response=>{if(response.status==="OK"){this.boss.options=response.data;this.boss.selected=Object.keys(response.data)[0]}else{console.log(response)}})},rosterChange(player){let data={week:this.week,boss:this.boss.selected,player:player};if(this.replace){data.replace=this.replace.name}DynamicSuite.call("baddies-insight","roster:change",data,response=>{if(response.status==="OK"){this.modal.state=false;this.getRoster()}else{console.log(response)}})},removeCharacter(character){let data={character_id:character.character.character_id,boss_id:this.boss.selected,week:this.week};DynamicSuite.call("baddies-insight","roster:remove",data,response=>{if(response.status==="OK"){this.getRoster()}else{console.log(response)}})},getMains(){DynamicSuite.call("baddies-insight","roster:mains.read",null,response=>{if(response.status==="OK"){this.characters=response.data}else{console.log(response)}})},getAlts(){},getRoster(){let data={boss_id:this.boss.selected,week:this.week};DynamicSuite.call("baddies-insight","roster:read",data,response=>{if(response.status==="OK"){this.characters_added=response.data}else{console.log(reponse)}})}},watch:{boss:{handler(){if(this.boss.selected){this.getRoster()}},deep:true}},mounted(){this.getInstances();this.getMains()}});